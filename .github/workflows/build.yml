name: Build
on:
  push:
    branches-ignore:
      - main
    paths-ignore:
      - .github/**
      - .gitignore
      - README.md
      - LICENSE
  workflow_dispatch:

permissions:
  contents: read

jobs:
  test:
    name: 'Test'
    runs-on: ubuntu-latest
    steps:
      - name: 'Check out code'
        uses: actions/checkout@v4

      - name: 'Set up Java'
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      - name: 'Set up Gradle'
        uses: gradle/gradle-build-action@v2

      - name: 'Run Gradle'
        run: ./gradlew build testAggregateTestReport --continue

      - name: 'Upload failed tests report'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: 'Tests report'
          path: build/reports/tests/unit-test/aggregated-results

  poc:
    name: 'POC'
    runs-on: ubuntu-latest
    steps:
      - name: 'Check out code'
        uses: actions/checkout@v4

#      - name: 'Set up SDKMAN! cache'
#        uses: actions/cache@v3
#        with:
#          path: ~/.sonar/cache
#          key: '${{ runner.os }}-sonar'
#          restore-keys: '${{ runner.os }}-sonar'

      - name: 'Install JDK with SDKMan'
        uses: sdkman/sdkman-action@main
        id: sdkman

      - name: 'Debug'
        run: |
          echo '${{ steps.sdkman.outputs.file }}'
          ls -al ${{ steps.sdkman.outputs.file }}

      - name: 'Set up Gradle'
        uses: gradle/gradle-build-action@v2

      - name: 'Run Gradle'
        run: ./gradlew build testAggregateTestReport --continue

      - name: 'Upload failed tests report'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: 'Tests report'
          path: build/reports/tests/unit-test/aggregated-results